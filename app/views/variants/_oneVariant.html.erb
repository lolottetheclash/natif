<% rating = item.review_average %>
<div class="col-md-6">
  <div class="swiper-container" id="product-slider">
    <div class="swiper-wrapper">
      <%= image_tag "item.jpg", :class => "swiper-slide w-100" %>
    </div>
  </div>
</div>
<div class="col-md-6 mt-3 mt-md-0 mt-3">
  <div class="row d-flex justify-content-between">
    <div><h3 class="card-title"><%= variant.title %></h3></div>
    <div class="mr-3"><i class="fas fa-tag"></i> <%= Category.find(item.category_id).name %></div>
  </div>
  <h6>
  	<span class="rating" data-value="<%= rating %>"></span>
    <a href="javascript:void(0)"><%= Review.where(item_id: item.id).size %> reviews</a>
  </h6>
  <h3 class="price">
    <span >$<%= variant.price %></span>
  </h3>
  <p class="d-none d-lg-block"><%= item.description.split("\n\n", 2)[0] %></p>

  <div class="form-group col-6">
    <% if variant.stock == 0 %>
      <div><span class="text-danger"><i class="fas fa-times-circle"></i></span> Indisponible</div> 
    <% else %>
      <div><span class="text-success"><i class="fas fa-check-circle"></i></span> Disponible </div>
    <% end %>
  </div>
  <div class="row d-flex justify-content-center">
    <div>
      <%= form_for Wishlist.new do |f| %>
        <%= f.hidden_field :variant_id, :value => variant.id %>
        <%= f.hidden_field :user_id, :value => current_user.id %>
        <%= button_tag(class: "btn btn-primary btn-block rounded-pill") do %>
          <i class="far fa-heart"></i> Ajouter Ã  la wishlist
        <% end %>
      <% end %>
    </div>
    <% if variant.stock != 0 %>
      <div class="ml-3">
        <% if user_signed_in? %>
          <% if Cart.where(user_id: current_user.id).where(order_id: nil).map(&:variant_id).include?(variant.id) %> 
            <%= link_to raw("<i class=\"fas fa-cart-plus\"></i> Ajouter au panier"), addtocart_path(Cart.where(user_id: current_user.id).where(order_id: nil).where(variant_id: variant.id).ids), method: "get", class: "btn btn-primary btn-block rounded-pill" %> 
          <% else %>  
            <%= form_for Cart.new do |f| %>
              <%= f.hidden_field :variant_id, :value => variant.id %>
              <%= f.hidden_field :user_id, :value => current_user.id %>
              <%= button_tag(class: "btn btn-primary btn-block rounded-pill") do %>
                <i class="fas fa-cart-plus"></i> Ajouter au panier
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>



<script>
$(function () {

  App.rating()
  App.atcDemo()
  App.atwDemo()
  App.colorOption()

  setTimeout(function (argument) {
    var productSlider = new Swiper('#product-slider', {
      loop: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      }
    })
  }, 100)

  // Collect items for photoswipe
  var items = []
  $('.swiper-wrapper img').each(function () {
    items.push({
      src: $(this).data('large'),
      w: 1395,
      h: 1500
    })
  })

  var openPhotoSwipe = function (items, activeIndex) {
    activeIndex = typeof activeIndex !== 'undefined' ? activeIndex : 0
    var pswpElement = document.querySelectorAll('.pswp')[0]
    var options = {
      index: activeIndex
    }
    var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options)
    gallery.init()
  }

  $('.zoom').click(function () {
    openPhotoSwipe(items, $('.swiper-wrapper').find('.swiper-slide-active').data('swiper-slide-index'))
  })

})
</script>